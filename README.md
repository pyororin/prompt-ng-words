# プロンプトインジェクション検出API (prompt-ng-api)

## 概要

このプロジェクトは、ユーザー入力におけるプロンプトインジェクションの試みを検出するために設計されたSpring Boot製APIです。
LLM（大規模言語モデル）などへの入力テキストを検査し、悪意のある指示や機密情報の漏洩につながる可能性のあるパターンを特定します。

## 主な機能

*   **ルールベースの検出**: `src/main/resources/prompt_injection_rules.yaml` ファイルに定義されたルールセットに基づいてインジェクションの試みを検出します。
    *   **禁止単語リスト**: 特定の危険な単語（日本語、英語、韓国語、中国語に対応）が含まれているかをチェックします。
    *   **インジェクションパターン**: 指示の上書き、役割の変更、機密情報の開示要求など、典型的なインジェクション手法に合致するフレーズや正規表現パターンを検出します。
*   **プロンプト言語制限**: 入力プロンプトは日本語のみ受け付けます。
*   **自然言語処理技術の活用**: テキスト解析の精度向上のため、以下の自然言語処理ライブラリを利用しています。
    *   `kuromoji-ipadic`: 日本語形態素解析によるトークン化と正規化に利用。
    *   `tika-langdetect-optimaize` (`org.apache.tika`): 入力テキストの言語検出に利用。
    *   `commons-text` (`org.apache.commons`): Jaro-Winkler類似度計算など、テキスト操作の補助に利用。
*   **Spring Bootベース**: Java 17 と Spring Boot 3.3.0 を使用して構築されており、既存のSpring Bootアプリケーションへの統合が容易です。

## 仕組み

APIは、受け取った入力テキストを `prompt_injection_rules.yaml` に記述されたルールと照合します。
このファイルには、以下の2つの主要なセクションがあります。

1.  `forbidden_words_jp`: 日本語、英語、韓国語、中国語の禁止単語のリスト。これらの単語が入力に含まれている場合、警告の対象となります。
2.  `injection_patterns`: プロンプトインジェクションとして識別されるフレーズや正規表現パターンのリスト。各パターンには、それが日本語のフレーズ (`japanese_phrase`)、または日本語の正規表現 (`japanese_regex`) であるかを示す `type` が関連付けられています。

一致するルールが見つかった場合、APIはそれが潜在的なプロンプトインジェクションであると判断できます。

## 今後の展望 (例)

*   より高度な検出ロジックの追加（例：機械学習モデルの利用）
*   詳細な設定オプションの提供

## APIドキュメント

このAPIはSwagger (OpenAPI) を使用してAPIドキュメントを提供します。
ドキュメントは、アプリケーションが `development` プロファイルで実行されている場合、またはプロファイルが指定されていない場合にのみ閲覧可能です。
`production` プロファイルがアクティブな場合は、セキュリティのためドキュメントは無効になります。

APIドキュメントには、以下のURLからアクセスできます:

`/swagger-ui.html` (例: `http://localhost:8080/swagger-ui.html`)

ドキュメントには、各エンドポイントの詳細、リクエストとレスポンスのスキーマ、およびパラメータの説明が日本語で記載されています。

---

*このAPIはプロンプトの検査を支援することを目的としています。*